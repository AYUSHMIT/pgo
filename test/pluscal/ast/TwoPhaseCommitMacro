------ MODULE AST -------
EXTENDS TLC
fairness == ""
 
ast == 
[type    |-> "multiprocess", 
 name  |-> "TwoPhaseCommit", 
 decls |-> <<[var |-> "managers", eqOrIn |-> "=", val |-> << "{", "\"", "bob", "\"", ",", "\"", "chuck", "\"", ",", "\"", "dave", "\"", ",", "\"", "everett", "\"", ",", "\"", "fred", "\"", "}" >>], 
             [var |-> "restaurant_stage", eqOrIn |-> "=", val |-> << "[", "mgr", "\\in", "managers", "|->", "\"", "start", "\"", "]" >>]>>,
 defs  |-> <<  >>,
 macros |-> <<[name   |-> "SetAll", 
               params |-> <<state, 
                            kmgrs>>,
               body   |-> <<[type    |-> "while", 
                             test    |-> << "kmgrs", "#", "{", "}" >>,
                             labDo   |-> <<>>,
                             unlabDo |-> <<[type   |-> "with", 
                                            var    |-> "km",
                                            eqOrIn |-> "\\in",
                                            exp    |-> << "kmgrs" >>,
                                            do     |-> <<[type |-> "assignment",
                                                          ass  |-> <<[lhs |-> [var |-> "restaurant_stage", sub |-> << "[", "km", "]" >>],
                                                                      rhs |-> << "state" >>]>>], 
                                                         [type |-> "assignment",
                                                          ass  |-> <<[lhs |-> [var |-> "kmgrs", sub |-> <<  >>],
                                                                      rhs |-> << "kmgrs", "\\", "{", "km", "}" >>]>>]>>]>>]>>]>>,
 prcds |-> <<>>,
 procs |-> <<[name   |-> "Restaurant",
              fairness |-> "unfair", minusLabels |-> <<>>, plusLabels |-><<>>, proceduresCalled |-><<>>,
              eqOrIn |-> "\\in",
              id     |-> << "managers" >>,
              decls  |-> <<>>,
              body   |-> <<[label |-> "c0",
                            stmts |-> <<[type |-> "when", 
                                         exp |-> << "restaurant_stage", "[", "self", "]", "=", "\"", "propose", "\"" >>], 
                                        [type |-> "either", 
                                         ors  |-> << <<[type |-> "assignment",
                                                        ass  |-> <<[lhs |-> [var |-> "restaurant_stage", sub |-> << "[", "self", "]" >>],
                                                                    rhs |-> << "\"", "accept", "\"" >>]>>]>>, 
                                                     <<[type |-> "assignment",
                                                        ass  |-> <<[lhs |-> [var |-> "restaurant_stage", sub |-> << "[", "self", "]" >>],
                                                                    rhs |-> << "\"", "refuse", "\"" >>]>>]>> >>]>>], 
                           [label |-> "c1",
                            stmts |-> <<[type |-> "when", 
                                         exp |-> << "(", "restaurant_stage", "[", "self", "]", "=", "\"", "commit", "\"", ")", "\\/"
, "(", "restaurant_stage", "[", "self", "]", "=", "\"", "abort", "\"", ")" >>], 
                                        [type    |-> "if", 
                                         test    |-> << "restaurant_stage", "[", "self", "]", "=", "\"", "commit", "\"" >>,
                                         then |-> <<[type |-> "assignment",
                                                     ass  |-> <<[lhs |-> [var |-> "restaurant_stage", sub |-> << "[", "self", "]" >>],
                                                                 rhs |-> << "\"", "committed", "\"" >>]>>]>>,
                                         else |-> <<[type |-> "assignment",
                                                     ass  |-> <<[lhs |-> [var |-> "restaurant_stage", sub |-> << "[", "self", "]" >>],
                                                                 rhs |-> << "\"", "aborted", "\"" >>]>>]>>]>>]>>], 
             [name   |-> "Controller",
              fairness |-> "unfair", minusLabels |-> <<>>, plusLabels |-><<>>, proceduresCalled |-><<>>,
              eqOrIn |-> "=",
              id     |-> << "\"", "alice", "\"" >>,
              decls  |-> <<[var |-> "rstMgrs", eqOrIn |-> "=", val |-> << "defaultInitValue" >>], 
                           [var |-> "aborted", eqOrIn |-> "=", val |-> << "FALSE" >>]>>,
              body   |-> <<[label |-> "n0",
                            stmts |-> <<[type |-> "assignment",
                                         ass  |-> <<[lhs |-> [var |-> "rstMgrs", sub |-> <<  >>],
                                                     rhs |-> << "managers" >>]>>]>>], 
                           [label |-> "n1",
                            stmts |-> <<[type    |-> "while", 
                                         test    |-> << "rstMgrs", "#", "{", "}" >>,
                                         labDo   |-> <<>>,
                                         unlabDo |-> <<[type   |-> "with", 
                                                        var    |-> "km",
                                                        eqOrIn |-> "\\in",
                                                        exp    |-> << "rstMgrs" >>,
                                                        do     |-> <<[type |-> "assignment",
                                                                      ass  |-> <<[lhs |-> [var |-> "restaurant_stage", sub |-> << "[", "km", "]" >>],
                                                                                  rhs |-> << "\"", "propose", "\"" >>]>>], 
                                                                     [type |-> "assignment",
                                                                      ass  |-> <<[lhs |-> [var |-> "rstMgrs", sub |-> <<  >>],
                                                                                  rhs |-> << "rstMgrs", "\\", "{", "km", "}" >>]>>]>>]>>], 
                                        [type |-> "assignment",
                                         ass  |-> <<[lhs |-> [var |-> "rstMgrs", sub |-> <<  >>],
                                                     rhs |-> << "managers" >>]>>]>>], 
                           [label |-> "n3",
                            stmts |-> <<[type    |-> "while", 
                                         test    |-> << "rstMgrs", "#", "{", "}" >>,
                                         labDo   |-> <<>>,
                                         unlabDo |-> <<[type   |-> "with", 
                                                        var    |-> "r",
                                                        eqOrIn |-> "\\in",
                                                        exp    |-> << "rstMgrs" >>,
                                                        do     |-> <<[type |-> "when", 
                                                                      exp |-> << "(", "restaurant_stage", "[", "r", "]", "=", "\"", "accept", "\"", ")", "\\/", "(", "restaurant_stage", "[", "r", "]", "=", "\"", "refuse", "\"", ")" >>], 
                                                                     [type    |-> "if", 
                                                                      test    |-> << "(", "restaurant_stage", "[", "r", "]", "=", "\"", "refuse", "\"", ")" >>,
                                                                      then |-> <<[type |-> "assignment",
                                                                                  ass  |-> <<[lhs |-> [var |-> "aborted", sub |-> <<  >>],
                                                                                              rhs |-> << "TRUE" >>]>>]>>,
                                                                      else |-> <<>>], 
                                                                     [type |-> "assignment",
                                                                      ass  |-> <<[lhs |-> [var |-> "rstMgrs", sub |-> <<  >>],
                                                                                  rhs |-> << "rstMgrs", "\\", "{", "r", "}" >>]>>]>>]>>], 
                                        [type |-> "assignment",
                                         ass  |-> <<[lhs |-> [var |-> "rstMgrs", sub |-> <<  >>],
                                                     rhs |-> << "managers" >>]>>], 
                                        [type      |-> "labelIf",
                                         test      |-> << "aborted", "=", "TRUE" >>,
                                         unlabThen |-> <<>>,
                                         labThen   |-> <<[label |-> "n4",
                                                          stmts |-> <<[type    |-> "while", 
                                                                       test    |-> << "rstMgrs", "#", "{", "}" >>,
                                                                       labDo   |-> <<>>,
                                                                       unlabDo |-> <<[type   |-> "with", 
                                                                                      var    |-> "km",
                                                                                      eqOrIn |-> "\\in",
                                                                                      exp    |-> << "rstMgrs" >>,
                                                                                      do     |-> <<[type |-> "assignment",
                                                                                                    ass  |-> <<[lhs |-> [var |-> "restaurant_stage", sub |-> << "[", "km", "]" >>],
                                                                                                                rhs |-> << "\"", "abort", "\"" >>]>>], 
                                                                                                   [type |-> "assignment",
                                                                                                    ass  |-> <<[lhs |-> [var |-> "rstMgrs", sub |-> <<  >>],
                                                                                                                rhs |-> << "rstMgrs", "\\", "{", "km", "}" >>]>>]>>]>>]>>]>>,
                                         unlabElse |-> <<>>,
                                         labElse   |-> <<[label |-> "nck",
                                                          stmts |-> <<[type |-> "assert", 
                                                                       exp |-> << "\\A", "rstMgr", "\\in", "rstMgrs", ":", "(", "restaurant_stage", "[", "rstMgr", "]", "=", "\"", "accept", "\"", ")" >>]>>], 
                                                         [label |-> "n5",
                                                          stmts |-> <<[type    |-> "while", 
                                                                       test    |-> << "rstMgrs", "#", "{", "}" >>,
                                                                       labDo   |-> <<>>,
                                                                       unlabDo |-> <<[type   |-> "with", 
                                                                                      var    |-> "km",
                                                                                      eqOrIn |-> "\\in",
                                                                                      exp    |-> << "rstMgrs" >>,
                                                                                      do     |-> <<[type |-> "assignment",
                                                                                                    ass  |-> <<[lhs |-> [var |-> "restaurant_stage", sub |-> << "[", "km", "]" >>],
                                                                                                                rhs |-> << "\"", "commit", "\"" >>]>>], 
                                                                                                   [type |-> "assignment",
                                                                                                    ass  |-> <<[lhs |-> [var |-> "rstMgrs", sub |-> <<  >>],
                                                                                                                rhs |-> << "rstMgrs", "\\", "{", "km", "}" >>]>>]>>]>>]>>]>>]
                                        >>]>>]>>]
==========================
